version: '3.9'
services:
  web:
    build:
      context: .
      dockerfile: DigitalButler.Web/Dockerfile
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - AI_BASE_URL=${AI_BASE_URL}
      - AI_MODEL=${AI_MODEL}
      - AI_API_KEY=${AI_API_KEY}
      - BUTLER_ADMIN_USERNAME=${BUTLER_ADMIN_USERNAME}
      - BUTLER_ADMIN_PASSWORD=${BUTLER_ADMIN_PASSWORD}
      - BUTLER_ADMIN_PASSWORD_HASH=${BUTLER_ADMIN_PASSWORD_HASH}
      - BUTLER_TIMEZONE=${BUTLER_TIMEZONE}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID}
      - TELEGRAM_ALLOWED_USER_ID=${TELEGRAM_ALLOWED_USER_ID}
      - GCAL_ICAL_URLS=${GCAL_ICAL_URLS}
      - GCAL_FEED1_NAME=${GCAL_FEED1_NAME}
      - GCAL_FEED1_URL=${GCAL_FEED1_URL}
      - GOOGLE_SERVICE_ACCOUNT_JSON=${GOOGLE_SERVICE_ACCOUNT_JSON}
      - GOOGLE_CALENDAR_ID=${GOOGLE_CALENDAR_ID}
      # Optional additional feeds (supported as GCAL_FEED{N}_NAME/URL)
      - GCAL_FEED2_NAME=${GCAL_FEED2_NAME}
      - GCAL_FEED2_URL=${GCAL_FEED2_URL}
      - GMAIL_ACCOUNTS=${GMAIL_ACCOUNTS}
      - GMAIL_HOST=${GMAIL_HOST}
      - GMAIL_PORT=${GMAIL_PORT}
      - GMAIL_USE_SSL=${GMAIL_USE_SSL}
      - GMAIL_UNREAD_ONLY_DEFAULT=${GMAIL_UNREAD_ONLY_DEFAULT}
      - GMAIL_DAYS_BACK_DEFAULT=${GMAIL_DAYS_BACK_DEFAULT}
      - GMAIL_MAX_MESSAGES_DEFAULT=${GMAIL_MAX_MESSAGES_DEFAULT}
      - UNSPLASH_ACCESS_KEY=${UNSPLASH_ACCESS_KEY}
      # Obsidian daily notes (synced via rsync to /var/notes on host)
      - OBSIDIAN_VAULT_PATH=/var/notes
      - OBSIDIAN_DAILY_NOTES_PATTERN=${OBSIDIAN_DAILY_NOTES_PATTERN:-04 archive/journal/daily journal/*.md}
      - OBSIDIAN_LOOKBACK_DAYS=${OBSIDIAN_LOOKBACK_DAYS:-30}
      - Database__SqlitePath=/data/butler.db
    ports:
      - "7766:8080"
    volumes:
      - butler-data:/data
      - /var/notes:/var/notes:ro
    restart: unless-stopped
volumes:
  butler-data:
